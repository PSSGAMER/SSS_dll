# This script is generated by CMake and called at BUILD time by the 'zips' target.
string(TIMESTAMP ARCHIVE_DATE "%Y%m%d%H%M%S" UTC)

set(MAIN_ARCHIVE "@CMAKE_BINARY_DIR@/zips/SuperSexySteam ${ARCHIVE_DATE}.7z")
set(CONFIG_ARCHIVE "@CMAKE_BINARY_DIR@/zips/SuperSexySteam - Config ${ARCHIVE_DATE}.7z")

message(STATUS "Creating main archive: ${MAIN_ARCHIVE}")
execute_process(
    COMMAND "@SEVEN_ZIP_EXECUTABLE@" a -mx9 -m9=lzma2
            "${MAIN_ARCHIVE}"
            "$<TARGET_FILE:SuperSexySteam>"
            "@CMAKE_CURRENT_SOURCE_DIR@/setup.sh"
    RESULT_VARIABLE ret
)
if(NOT ret EQUAL 0)
    message(FATAL_ERROR "7z failed to create main archive.")
endif()

if(EXISTS "@CMAKE_CURRENT_SOURCE_DIR@/config.yaml.default")
    message(STATUS "Creating config archive: ${CONFIG_ARCHIVE}")
    execute_process(
        COMMAND "@SEVEN_ZIP_EXECUTABLE@" a -mx9 -m9=lzma2
                "${CONFIG_ARCHIVE}"
                "@CMAKE_CURRENT_SOURCE_DIR@/config.yaml.default"
        RESULT_VARIABLE ret
    )
    if(NOT ret EQUAL 0)
        message(FATAL_ERROR "7z failed to create config archive.")
    endif()
endif()